{% import dir_macro ~ '/functions.html.twig' as f %}
{% set categories = data.category %}
{% set item = data.item %}
{% set user = data.user %}
{% set files = data.files %}
{% set status = data.status %}

<div class='mall-page'>
	{% if item %}
		{% set title = ko ? '물품 수정' : 'Edit your item post' %}
	{% else %}
		{% set title = ko ? '판매 물품 등록' : 'Sell your item now' %}
	{% endif %}
	<div class='title'>{{ title }}</div>
	{% include 'modules/mall/templates/error.html.twig' %}
	{% include 'modules/mall/templates/mall.admin.commands.html.twig' %}
	<section class="content mall-item-add">
		<form class='item-add-form' method='post' action='/mall/item/edit/submit'>

			<input type='hidden' name='fids' value=''>

			<input type='hidden' name='item_id' value='{{ input.item_id }}'>
			<div class='description'>{{ ko ? '제목' : 'Title' }}</div>
			<input type='text' name='title' placeholder='{{ ko ? '제목을 입력하세요.' : 'Item Title' }}' value='{{ item.title.value }}' required>
			<div class='description'>{{ ko ? '상품명' : 'What is the name of the item?' }}</div>
			<input type='text' name='name' placeholder='{{ ko ? '상품명을 입력하세요.' : 'Item Name' }}' value='{{ item.name.value }}' required>
			<div class='description'>{{ ko ? '카테고리 선택' : 'In what category does your item fall?' }}</div>
			<div class='categories clearfix'>
				{% for category in categories %}
					<select class='category' {{ loop.index == data.category_last_selected ? "name=category_id" }} depth='0' {{ loop.index == 1 ? 'required' }}>
						<option value=''>{{ ko ? '카테고리' : 'Category' }}</option>
						{% for c in category.entity %}
							<option value='{{ c.id.value }}' {{ category.selected == c.id.value ? 'selected' }}>{{ f.get(ko, c.name.value) }}</option>
						{% endfor %}
					</select>
				{% endfor %}
			</div>
			<div class='description'>{{ ko ? '제조 회사명' : 'Brand' }}</div>
			<input type='text' name='brand' value='{{ item.brand.value }}' placeholder="{{ ko ? '제품 제조 회사명을 입력하세요' : 'Input Brand' }}">
			<div class='note'>Ex) Samsung, Company Name</div>
			<div class='description'>{{ ko ? '모델' : 'Model' }}</div>
			<input type='text' name='model' value='{{ item.model.value }}' placeholder="{{ ko ? '모델명을 입력하세요.' : 'Input model' }}">
			<div class='note'>Ex) Galaxy S5</div>
			<div class='description'>{{ ko ? '제조 년도' : 'Model Year' }}</div>
			<input type='number' name='model_year' value='{{ item.model_year.value }}'>
			<div class='description'>{{ ko ? '가격' : 'Price' }}</div>
			<div class='price-wrapper'>
				{#<span class='currency'>₱</span>#}
				<input type='number' name='price' value='{{ item.price.value }}'>
			</div>
			{#
			<div class='note'>1.) Item price must be within a realistic value range</div>
			<div class='note'>2.) You can leave the price blank or '0' value if the price can be discussed with buyers or sellers</div>
			#}
			<div class='description'>{{ ko ? '전화번호' : 'Phone Number' }}</div>
			{% if item.mobile.value %}
				{% set mobile = item.mobile.value %}
			{% else %}
				{% set mobile = user.field_mobile.value %}
			{% endif %}
			<input type='text' name='mobile' value='{{ mobile }}' required>
			{#
			<div class='note'>1.) You can seperate phone numbers by using comma (,)</div>
			<div class='note'>2.) Indicate the number where your buyer will contact you. Format: 09xxxxxxxxx (e.g. 09158787666)</div>
			#}

			<div class='description'>{{ ko ? '판매자 위치' : 'Seller Location' }}</div>
			<div class='location-wrapper clearfix'>
				<select class='location' name='province' required>
					<option value=''>Province</option>
					{% for p in data.provinces %}
						<option value='{{ p }}'{{ p == item.province.value ? " selected" }}>{{ p }}</option>
					{% endfor %}
				</select>
				{% if item.city %}
					<select class='location' name='city' required>
						<option value=''>City</option>
						{% for k,v in data.cities %}
							<option value='{{ k }}'{{ k == item.city.value ? " selected" }}>{{ v }}</option>
						{% endfor %}
					</select>
				{% endif %}
			</div>
			<div class='description'>{{ ko ? '배달 가능 지역' : 'Delivery Locations' }}</div>
			<input type='text' name='location' value='{{ item.location.value }}' required>
			{#
			<div class='note'>1.) Places where you may do meetups.</div>
			<div class='note'>2.) Please add them in an understandable way. In case of multiple places you may use comma (,) to separate it.</div>
			#}
			{#

			<div class='description'>What is the condition of your item?</div>
			<select name='status' required>
				<option value=''>Item Status</option>
				{% for k,v in status %}
					<option value='{{ k }}' {{ item.status.value == k ? 'selected' }}>{{ v }}</option>
				{% endfor %}
			</select>
			#}
			<div class='description'>{{ ko ? '상품 설명' : 'Description' }}</div>
			<textarea name='content' required>{{ item.content.value }}</textarea>
			<div class='buttons'>
				<input class='item-add-submit' type='submit' value='{{ ko ? '상품 등록' : 'Post Item' }}'>
			</div>
		</form>






		<div class='file-upload-group item_image_thumbnail clearfix'>
			<div class='upload-label'>{{ ko ? '메인에 표시 될 작은 이미지' : 'Item Image Thumbnail' }}</div>
			<div class='upload item_image_thumbnail'>
				<form class="addForm-file-upload{{ files.item_image_thumbnail[0] ? ' is-hidden' }}" action="/mall/api?call=fileUpload" method="POST">
					<img class='fake' src='/modules/mall/img/fake_upload_photo.png'/>
					<fieldset><div class="row"><span class="value"><span class="element">
							<input type="hidden" name="call" value="fileUpload">
							<input type="hidden" name="image_style" value="medium">
							<input type='file' name='item_image_thumbnail' onchange="jQuery(this).parent().submit();">
						</span></span></div></fieldset>
				</form>
				<div class='display-uploaded-files clearfix'>
					{% if files.item_image_thumbnail[0] %}
						<div class='photo' fid='{{ files.item_image_thumbnail[0].fid }}'>
							<div class='delete'><span>X</span></div>
							<img src='{{ files.item_image_thumbnail[0].url_medium }}'>
						</div>
					{% endif %}
				</div>
			</div>
		</div>
		<div class='file-upload-group item_image clearfix'>
			<div class='upload-label'>{{ ko ? '상품 이미지' : 'Item Images' }}</div>
			{% for i in 1..10 %}
				<div class='upload' no = '{{ i }}'>
					<form class="addForm-file-upload{{ files.item_image[i] ? ' is-hidden' }}" action="/mall/api?call=fileUpload" method="POST">
						<img class='fake' src='/modules/mall/img/fake_upload_photo.png'/>
						<fieldset><div class="row"><span class="value"><span class="element">
							<input type="hidden" name="call" value="fileUpload">
							<input type="hidden" name="image_style" value="medium">
							<input type="hidden" name="no" value="{{ i }}">
							<input type='file' name='item_image' onchange="jQuery(this).parent().submit();">
						</span></span></div></fieldset>
					</form>
					<div class='display-uploaded-files clearfix'>
						{% if files.item_image[i] %}
							<div class='photo' fid='{{ files.item_image[i].fid }}'>
								<div class='delete'><span>X</span></div>
								<img src='{{ files.item_image[i].url_medium }}'>
							</div>
						{% endif %}
					</div>
				</div>
			{% endfor %}
		</div>
		<div class='file-upload-group item_image_description clearfix'>
			<div class='upload-label'>{{ ko ? '상품 설명 이미지' : 'Item Image Description' }}</div>
			{% for i in 1..3 %}
				<div class='upload' no = '{{ i }}'>
					<form class="addForm-file-upload{{ files.item_image_description[i] ? ' is-hidden' }}" action="/mall/api?call=fileUpload" method="POST">
						<img class='fake' src='/modules/mall/img/fake_upload_photo.png'/>
						<fieldset><div class="row"><span class="value"><span class="element">
								<input type="hidden" name="call" value="fileUpload">
								<input type="hidden" name="image_style" value="medium">
								<input type="hidden" name="no" value="{{ i }}">
								<input type='file' name='item_image_description' onchange="jQuery(this).parent().submit();">
							</span></span></div></fieldset>
					</form>
					<div class='display-uploaded-files clearfix'>
						{% if files.item_image_description[i] %}
							<div class='photo' fid='{{ files.item_image_description[i].fid }}'>
								<div class='delete'><span>X</span></div>
								<img src='{{ files.item_image_description[i].url_medium }}'>
							</div>
						{% endif %}
					</div>
				</div>
			{% endfor %}
		</div>
		<div class='buttons'>
			<div class='item-add-submit'>{{ ko ? '상품 등록' : 'Post Item' }}</div>
		</div>
	</section>
</div>
